<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>xnattagger Documentation &mdash; DWIQC  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Developer Documentation" href="developers.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            DWIQC
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="xnat.html">User Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="developers.html">Developer Documentation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">xnattagger Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#possible-tagging-convention-overview">Possible Tagging Convention Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuring-xnattagger">Configuring xnattagger</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tagger-yaml-file">tagger.yaml file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#xnat-scan-type">XNAT Scan Type</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#running-xnattagger">Running xnattagger</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#required-arguments">Required Arguments</a></li>
<li class="toctree-l3"><a class="reference internal" href="#executing-the-command">Executing the Command</a></li>
<li class="toctree-l3"><a class="reference internal" href="#expected-output">Expected Output</a></li>
<li class="toctree-l3"><a class="reference internal" href="#common-errors">Common Errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#advanced-usage">Advanced Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#all-arguments">All Arguments</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scripting-for-xnattagger">Scripting for <em>xnattagger</em></a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">DWIQC</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">xnattagger Documentation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/xnattagger.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="xnattagger-documentation">
<h1>xnattagger Documentation<a class="headerlink" href="#xnattagger-documentation" title="Permalink to this heading"></a></h1>
<p><em>xnattagger</em> is a python command line tool that labels or “tags” scans within an XNAT instance according to user specifications.</p>
<section id="possible-tagging-convention-overview">
<h2>Possible Tagging Convention Overview<a class="headerlink" href="#possible-tagging-convention-overview" title="Permalink to this heading"></a></h2>
<p>“Tagging” refers to adding notes to your scans’ notes field in XNAT. The example below shows the tags that could be added to the notes field for each of the different modalities using <em>xnattagger</em> along with some example series names for each modality.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Example series</p></th>
<th class="head"><p>Tag Being Inserted Into Note Field</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>DWI</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">UKbioDiff_ABCDseq_ABCDdvs</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">#DWI_MAIN_001,</span> <span class="pre">#DWI_MAIN_002,</span> <span class="pre">...,</span> <span class="pre">#DWI_MAIN_N</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>DWI_PA_FMAP</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">UKbioDiff_ABCDseq_DistMap_PA</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">#DWI_PA_001,</span> <span class="pre">#DWI_PA_002,</span> <span class="pre">...,</span> <span class="pre">#DWI_PA_N</span></code></p></td>
</tr>
<tr class="row-even"><td><p>DWI_AP_FMAP</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">UKbioDiff_ABCDseq_DistMap_AP</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">#DWI_AP_001,</span> <span class="pre">#DWI_AP_002,</span> <span class="pre">...,</span> <span class="pre">#DWI_AP_N</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>DWI_REVPOL</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">CMRR_DiffPA_2mm_4b0</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">#DWI_REVPOL_001</span></code>, <code class="docutils literal notranslate"><span class="pre">#DWI_REVPOL_002</span></code>, <code class="docutils literal notranslate"><span class="pre">#DWI_REVPOL_N</span></code></p></td>
</tr>
<tr class="row-even"><td><p>BOLD</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ABCD_fMRI_rest_noPMU</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">#BOLD_001,</span> <span class="pre">#BOLD_002,</span> <span class="pre">...,</span> <span class="pre">#BOLD_N</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>BOLD_PA</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ABCD_fMRI_DistortionMap_PA</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">#BOLD_PA_001,</span> <span class="pre">#BOLD_PA_002,</span> <span class="pre">...,</span> <span class="pre">#BOLD_PA_N</span></code></p></td>
</tr>
<tr class="row-even"><td><p>BOLD_AP</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ABCD_fMRI_DistortionMap_AP</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">#BOLD_AP_001,</span> <span class="pre">#BOLD_AP_002,</span> <span class="pre">...,</span> <span class="pre">#BOLD_AP_N</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>T1w</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ABCD_T1w_MPR_vNav</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">#T1w_001,</span> <span class="pre">#T1w_001,</span> <span class="pre">...,</span> <span class="pre">#T1w_N</span></code></p></td>
</tr>
<tr class="row-even"><td><p>T1w_MOVE</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ABCD_T1w_MPR_vNav_setter</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">#T1w_MOVE_001,</span> <span class="pre">#T1w_MOVE_002,</span> <span class="pre">...,</span> <span class="pre">#T1w_MOVE_N</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>T2w</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ABCD_T2w_SPC_vNav</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">#T2w_001,</span> <span class="pre">#T2w_002,</span> <span class="pre">...,</span> <span class="pre">#T2w_N</span></code></p></td>
</tr>
<tr class="row-even"><td><p>T2w_MOVE</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ABCD_T2w_SPC_vNav_setter</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">#T2w_MOVE_001,</span> <span class="pre">#T2w_MOVE_002,</span> <span class="pre">...,</span> <span class="pre">#T2w_MOVE_N</span></code></p></td>
</tr>
</tbody>
</table>
<p>The image below displays an MR Session report page with populated notes.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If a <code class="docutils literal notranslate"><span class="pre">DWI</span></code> scan has corresponding <code class="docutils literal notranslate"><span class="pre">PA</span></code> and <code class="docutils literal notranslate"><span class="pre">AP</span></code> scans, they should be assigned matching numbers. For example, <code class="docutils literal notranslate"><span class="pre">#DWI_MAIN_001</span></code> would correspond to <code class="docutils literal notranslate"><span class="pre">#DWI_PA_001</span></code> and <code class="docutils literal notranslate"><span class="pre">#DWI_AP_001</span></code>. Some diffusion studies will not have dedicated fieldmaps and will use reverse polarity (“revpol”) acquisitions instead. Since these “revpol” scans can be applied to several “main” diffusion scans, it is recommended that they be grouped in an an identifiable way. For example, adding a letter to the tag. See this <a class="reference external" href="xnat.html#get-config-file">explanation</a> for further details. The config <a class="reference external" href="#tagger-yaml-file">file</a> below also can serve as an example.</p>
</div>
<img alt="_images/xnat-scan-notes.png" src="_images/xnat-scan-notes.png" />
</section>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this heading"></a></h2>
<p>Install <em>xnattagger</em> via pip:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>xnattagger
</pre></div>
</div>
<p>Verify that it installed sucessfully:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>show<span class="w"> </span>xnattagger
</pre></div>
</div>
</section>
<section id="configuring-xnattagger">
<h2>Configuring xnattagger<a class="headerlink" href="#configuring-xnattagger" title="Permalink to this heading"></a></h2>
<section id="tagger-yaml-file">
<h3>tagger.yaml file<a class="headerlink" href="#tagger-yaml-file" title="Permalink to this heading"></a></h3>
<p>In order for <em>xnattagger</em> to work properly, it has to know what it’s looking for as it parses information about the scans. Particularly, it needs to know the series name and image type that correspond to the different scans and modalities. That’s where the <em>tagger.yaml</em> config file comes in. Take a look at the example below (<a class="reference external" href="https://github.com/harvard-nrg/xnattagger/blob/main/tagger.yaml">download</a>). Notice that each modality has a series description, image type and tag associated with it.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Each modality/scan type can have several <em>series_description</em> and <em>image_type</em> fields that it tries to match to. In the example below, all three of the diffusion scan types have two sets of <em>series_description</em> and <em>image_type</em> fields. This means that <em>xnattagger</em> will tag diffusion scans that match <strong>either</strong> of those descriptions/scan types. If you have different series descriptions across projects/sites, you can catch and tag them all this way. The <em>tag</em> field is completely customizable. Whatever you put there will be inserted into the notes field on XNAT.</p>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">t1w</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">series_description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ABCD_T1w_MPR_vNav</span>
<span class="w">      </span><span class="nt">image_type</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ORIGINAL</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">PRIMARY</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">M</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">ND</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">NORM</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;#T1w&#39;</span>
<span class="nt">t1w_move</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">series_description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ABCD_T1w_MPR_vNav_setter</span>
<span class="w">      </span><span class="nt">image_type</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ORIGINAL</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">PRIMARY</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">M</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">ND</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">MOSAIC</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;#T1w_MOVE&#39;</span>
<span class="nt">t2w</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">series_description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ABCD_T2w_SPC_vNav</span>
<span class="w">      </span><span class="nt">image_type</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ORIGINAL</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">PRIMARY</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">M</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">ND</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">NORM</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;#T2w&#39;</span>
<span class="nt">t2w_move</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">series_description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ABCD_T2w_SPC_vNav_setter</span>
<span class="w">      </span><span class="nt">image_type</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ORIGINAL</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">PRIMARY</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">M</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">ND</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">MOSAIC</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;#T2w_MOVE&#39;</span>
<span class="nt">dwi</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">series_description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CMRR_DiffAP_2mm_20dir_Set1</span>
<span class="w">      </span><span class="nt">image_type</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ORIGINAL</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">PRIMARY</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">DIFFUSION</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">NONE</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">MB</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">ND</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">MOSAIC</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;#DWI_MAIN_A_001&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">series_description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CMRR_DiffAP_2mm_20dir_Set2</span>
<span class="w">      </span><span class="nt">image_type</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ORIGINAL</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">PRIMARY</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">DIFFUSION</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">NONE</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">MB</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">ND</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">MOSAIC</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;#DWI_MAIN_A_002&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">series_description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CMRR_DiffAP_2mm_20dir_Set3</span>
<span class="w">      </span><span class="nt">image_type</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ORIGINAL</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">PRIMARY</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">DIFFUSION</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">NONE</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">MB</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">ND</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">MOSAIC</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;#DWI_MAIN_B_001&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">series_description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CMRR_DiffAP_2mm_20dir_Set4</span>
<span class="w">      </span><span class="nt">image_type</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ORIGINAL</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">PRIMARY</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">DIFFUSION</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">NONE</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">MB</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">ND</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">MOSAIC</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;#DWI_MAIN_B_002&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">series_description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Axial MB DTI PA (MSV21)</span>
<span class="w">      </span><span class="nt">image_type</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ORIGINAL</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">PRIMARY</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">DIFFUSION</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">NONE</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">ND</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">NORM</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">MOSAIC</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;#DWI_MAIN_C_001&#39;</span>
<span class="nt">revpol</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">series_description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CMRR_DiffPA_2mm_4b0</span>
<span class="w">      </span><span class="nt">image_type</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ORIGINAL</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">PRIMARY</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">M</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">MB</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">ND</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">note</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;DIFF_2.0_4B0_Set12&#39;</span>
<span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;#DWI_REVPOL_A_001&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">series_description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CMRR_DiffPA_2mm_4b0</span>
<span class="w">      </span><span class="nt">image_type</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ORIGINAL</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">PRIMARY</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">M</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">MB</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">ND</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">note</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DIFF_2.0_4B0_Set34</span>
<span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;#DWI_REVPOL_B_001&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">series_description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Axial MB DTI AP (MSV21)</span>
<span class="w">      </span><span class="nt">image_type</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ORIGINAL</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">PRIMARY</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">DIFFUSION</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">NONE</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">ND</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">NORM</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">MOSAIC</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;#DWI_REVPOL_C_001&#39;</span>
<span class="nt">dwi_PA</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">series_description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ABCD_dMRI_DistortionMap_PA</span>
<span class="w">      </span><span class="nt">image_type</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ORIGINAL</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">PRIMARY</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">DIFFUSION</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">NONE</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">ND</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;#DWI_FMAP_PA&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">series_description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UKbioDiff_ABCDseq_DistMap_PA</span>
<span class="w">      </span><span class="nt">image_type</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ORIGINAL</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">PRIMARY</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">DIFFUSION</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">NONE</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">ND</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;#DWI_FMAP_PA&#39;</span>
<span class="nt">dwi_AP</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">series_description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ABCD_dMRI_DistortionMap_AP</span>
<span class="w">      </span><span class="nt">image_type</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ORIGINAL</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">PRIMARY</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">DIFFUSION</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">NONE</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">ND</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;#DWI_FMAP_AP&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">series_description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UKbioDiff_ABCDseq_DistMap_AP</span>
<span class="w">      </span><span class="nt">image_type</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ORIGINAL</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">PRIMARY</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">DIFFUSION</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">NONE</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">ND</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;#DWI_FMAP_AP&#39;</span>
<span class="nt">bold</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">series_description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ABCD_fMRI_rest_noPMU</span>
<span class="w">      </span><span class="nt">image_type</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ORIGINAL</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">PRIMARY</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">M</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">ND</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">MOSAIC</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;#BOLD&#39;</span>
<span class="nt">bold_PA</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">series_description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ABCD_fMRI_DistortionMap_PA</span>
<span class="w">      </span><span class="nt">image_type</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ORIGINAL</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">PRIMARY</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">M</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">ND</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;#BOLD_FMAP_PA&#39;</span>
<span class="nt">bold_AP</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">series_description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ABCD_fMRI_DistortionMap_AP</span>
<span class="w">      </span><span class="nt">image_type</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ORIGINAL</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">PRIMARY</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">M</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">ND</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;#BOLD_FMAP_AP&#39;</span>
</pre></div>
</div>
</section>
<section id="xnat-scan-type">
<h3>XNAT Scan Type<a class="headerlink" href="#xnat-scan-type" title="Permalink to this heading"></a></h3>
<p>You can find the series description and image type information in your XNAT instance.</p>
<div class="line-block">
<div class="line">1. Start by clicking on a project on your XNAT instance homepage.</div>
</div>
<img alt="_images/xnat-projects.png" src="_images/xnat-projects.png" />
<div class="line-block">
<div class="line">2. Click on <em>Scan Type Cleanup</em> on the right side of the page.</div>
</div>
<img alt="_images/scan-cleanup.png" src="_images/scan-cleanup.png" />
<div class="line-block">
<div class="line">3. You will see a page that lists all of the series descriptions and image types that exist within the project. You will need to pull the information from here to populate your <em>tagger.yaml</em> file.</div>
</div>
<img alt="_images/all-types.png" src="_images/all-types.png" />
<p>Let’s look at the diffusion acquisition as an example. Notice that the <em>series_description</em> in the <em>tagger.yaml</em> file above matches the <em>Scan Type</em> column in XNAT and the <em>image_type</em> in <em>tagger.yaml</em> matches the <em>Image Type</em> in XNAT. Be sure to follow the same tokenizing convention when copying the <em>Image Type</em> from XNAT to the <em>image_type</em> in <em>tagger.yaml</em>. The “\” should be replaced with a comma and a space. Here is how we would convert the information form XNAT to yaml format using our diffusion example:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>XNAT</p></th>
<th class="head"><p>tagger.yaml</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Scan Type</strong>: ABCD_dMRI_lowSR</p></td>
<td><p><strong>series_description</strong>: ABCD_dMRI_lowSR</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Image Type</strong>: ORIGINAL\PRIMARY\DIFFUSION\NONE\ND\MOSAIC</p></td>
<td><p><strong>image_type</strong>: [ORIGINAL, PRIMARY, DIFFUSION, NONE, ND, MOSAIC]</p></td>
</tr>
</tbody>
</table>
<p>Follow the same convention for all your modalities and you will be good to go!</p>
</section>
</section>
<section id="running-xnattagger">
<h2>Running xnattagger<a class="headerlink" href="#running-xnattagger" title="Permalink to this heading"></a></h2>
<section id="required-arguments">
<h3>Required Arguments<a class="headerlink" href="#required-arguments" title="Permalink to this heading"></a></h3>
<p><em>xnattagger</em> requires three arguments: <cite>1) —label</cite> <cite>2) —target-modality</cite> <cite>3) —xnat-alias</cite> <cite>4) —config</cite></p>
<div class="line-block">
<div class="line">1. <code class="docutils literal notranslate"><span class="pre">--label</span></code> refers to the XNAT MR Session ID, which is found under XNAT PROJECT —&gt; SUBJECT —&gt; MR_SESSION</div>
</div>
<img alt="_images/MR-Session.png" src="_images/MR-Session.png" />
<div class="line-block">
<div class="line">2. <code class="docutils literal notranslate"><span class="pre">--target-modality</span></code> refers to which modalities you want to tag. This argument may be <strong>one</strong> of the following: <code class="docutils literal notranslate"><span class="pre">dwi</span></code>, <code class="docutils literal notranslate"><span class="pre">t1</span></code>, <code class="docutils literal notranslate"><span class="pre">t2</span></code>, <code class="docutils literal notranslate"><span class="pre">bold</span></code>, <code class="docutils literal notranslate"><span class="pre">all</span></code></div>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>--target-modality<span class="w"> </span><span class="o">{</span>dwi,<span class="w"> </span>t1,<span class="w"> </span>t2,<span class="w"> </span>bold,<span class="w"> </span>all<span class="o">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">3. <code class="docutils literal notranslate"><span class="pre">--xnat-alias</span></code> is the alias containing credentials associated with your XNAT instance. It can be created in a few <a class="reference external" href="https://yaxil.readthedocs.io/en/latest/xnat_auth.html">steps</a> with yaxil.</div>
</div>
<div class="line-block">
<div class="line">4. <code class="docutils literal notranslate"><span class="pre">--config</span></code> is the <strong>absolute</strong> path to the <em>tagger.yaml</em> file you created, or downloaded, above.</div>
</div>
</section>
<section id="executing-the-command">
<h3>Executing the Command<a class="headerlink" href="#executing-the-command" title="Permalink to this heading"></a></h3>
<p>Command Template:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>xnat_tagger.py<span class="w"> </span>--label<span class="w"> </span>&lt;MR_SESSION&gt;<span class="w"> </span>target-modality<span class="w"> </span>&lt;MODALITY&gt;<span class="w"> </span>--xnat-alias<span class="w"> </span>&lt;ALIAS&gt;<span class="w"> </span>--config<span class="w"> </span>&lt;PATH_TO_CONFIG_FILE&gt;
</pre></div>
</div>
<p>Command Example:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>xnat_tagger.py<span class="w"> </span>--label<span class="w"> </span>PE201222_230719<span class="w"> </span>--target-modality<span class="w"> </span>all<span class="w"> </span>--xnat-alias<span class="w"> </span>ssbc<span class="w"> </span>--config<span class="w"> </span>/home/nrg/tagger.yaml
</pre></div>
</div>
</section>
<section id="expected-output">
<h3>Expected Output<a class="headerlink" href="#expected-output" title="Permalink to this heading"></a></h3>
<p>Your terminal output should look something like this:</p>
<img alt="_images/tagger-output.png" src="_images/tagger-output.png" />
<p>If your tag already exists in the notes field on XNAT, you’ll get a terminal message that looks something like this:</p>
<img alt="_images/tagger-exists.png" src="_images/tagger-exists.png" />
</section>
<section id="common-errors">
<h3>Common Errors<a class="headerlink" href="#common-errors" title="Permalink to this heading"></a></h3>
<p>Many errors tend to stem from mis-formatting the tagger.yaml file. Learn about <a class="reference external" href="https://www.youtube.com/watch?v=9BGWtTahGnw">yaml here</a>. Follow the example given above closely!</p>
</section>
<section id="advanced-usage">
<h3>Advanced Usage<a class="headerlink" href="#advanced-usage" title="Permalink to this heading"></a></h3>
<p>If you would like to see what tags will be uploaded to XNAT without actually doing it, pass the <code class="docutils literal notranslate"><span class="pre">--dry-run</span></code> argument. You will also have to specify an output json file: <code class="docutils literal notranslate"><span class="pre">-o</span> <span class="pre">test.json</span></code>. That json file will contain metadata about the tags <em>xnattagger</em> mode <strong>would</strong> upsert. This can be useful for testing/debugging.</p>
</section>
<section id="all-arguments">
<h3>All Arguments<a class="headerlink" href="#all-arguments" title="Permalink to this heading"></a></h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Argument</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Required</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--label</span></code></p></td>
<td><p>XNAT Session Label</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--target-modality</span></code></p></td>
<td><p>Modality to tag</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--xnat-alias</span></code></p></td>
<td><p>Alias for XNAT Project</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--config</span></code></p></td>
<td><p>Configuration file for tagging scans</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--project</span></code></p></td>
<td><p>Project Name</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--confirm</span></code></p></td>
<td><p>User confirms each tag</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--dry-run</span></code></p></td>
<td><p>Generate list of to-be-downloaded scans</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-o</span></code></p></td>
<td><p>Path to <code class="docutils literal notranslate"><span class="pre">--dry-run</span></code> json output file</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
</section>
<section id="scripting-for-xnattagger">
<h3>Scripting for <em>xnattagger</em><a class="headerlink" href="#scripting-for-xnattagger" title="Permalink to this heading"></a></h3>
<p>You can tag scans for all the subjects and projects in your XNAT instance through a combination of yaxil, <em>xnattagger</em> and the XNAT REST API. The example below (written in python) assumes that you’ve created an <em>xnat alias</em> (auth in the example) using yaxil and that your instance has three projects named: Michigan, Kansas and UCSD</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">yaxil</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="n">projects</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Michigan&quot;</span><span class="p">,</span> <span class="s2">&quot;Kansas&quot;</span><span class="p">,</span> <span class="s2">&quot;UCSD&quot;</span><span class="p">]</span>

<span class="k">with</span> <span class="n">yaxil</span><span class="o">.</span><span class="n">session</span><span class="p">(</span><span class="n">auth</span><span class="p">)</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">project</span> <span class="ow">in</span> <span class="n">projects</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">subject</span> <span class="ow">in</span> <span class="n">sess</span><span class="o">.</span><span class="n">subjects</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="n">project</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">experiment</span> <span class="ow">in</span> <span class="n">sess</span><span class="o">.</span><span class="n">experiments</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">):</span>
                                <span class="n">tagger</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;xnat_tagger.py --alias example --config /home/nrg/tagging.yaml --target-modality all --label </span><span class="si">{</span><span class="n">experiment</span><span class="si">}</span><span class="s1">&#39;</span>
                                <span class="n">proc1</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">tagger</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
                                <span class="n">proc1</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
</pre></div>
</div>
<p>And that’s it! Contact <em>info&#64;neuroinfo.org</em> with any questions or suggestions.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="developers.html" class="btn btn-neutral float-left" title="Developer Documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, info@neuroinfo.org.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>