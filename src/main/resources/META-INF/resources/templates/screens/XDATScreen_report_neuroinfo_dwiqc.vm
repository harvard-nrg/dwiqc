#set($dtype = $!item.getXSIType())
#set($mr_label = $!item.getStringProperty("${dtype}/session_label"))
#set($mr_id = $!item.getStringProperty("${dtype}/imageSession_ID"))
#set($aid = $!item.getStringProperty("${dtype}.ID"))
#set($project = $!item.getStringProperty("${dtype}/project"))
#set ($floatFormat3 = '0.###')
#macro (numberFormat $format $number)
    #set ($d = $item.getClass().forName('java.text.DecimalFormat').newInstance())
    $d.applyPattern($format)
    $d.format($number)
#end


#set($b0_avg = $content.getURI("/data/experiments/$!{mr_id}/assessors/$!{aid}/files/b0_avg/$!{aid}_preprocessed_b0.png"))
#set($b500_avg = $content.getURI("/data/experiments/$!{mr_id}/assessors/$!{aid}/files/b500_avg/$!{aid}_preprocessed_b500.png"))
#set($b1000_avg = $content.getURI("/data/experiments/$!{mr_id}/assessors/$!{aid}/files/b1000_avg/$!{aid}_preprocessed_b1000.png"))
#set($b2000_avg = $content.getURI("/data/experiments/$!{mr_id}/assessors/$!{aid}/files/b2000_avg/$!{aid}_preprocessed_b2000.png"))
#set($b3000_avg = $content.getURI("/data/experiments/$!{mr_id}/assessors/$!{aid}/files/b3000_avg/$!{aid}_preprocessed_b3000.png"))
#set($FA_map = $content.getURI("/data/experiments/$!{mr_id}/assessors/$!{aid}/files/FA_map/$!{aid}_FA.png"))
#set($MD_map = $content.getURI("/data/experiments/$!{mr_id}/assessors/$!{aid}/files/MD_map/$!{aid}_MD.png"))
#set($eddy_outlier_slices = $content.getURI("/data/experiments/$!{mr_id}/assessors/$!{aid}/files/eddy_outliers/$!{aid}_eddy_outlier_slices.png"))
#set($translations = $content.getURI("/data/experiments/$!{mr_id}/assessors/$!{aid}/files/translations/$!{aid}_translations.png"))
#set($rotations = $content.getURI("/data/experiments/$!{mr_id}/assessors/$!{aid}/files/rotations/$!{aid}_rotations.png"))
#set($displacements = $content.getURI("/data/experiments/$!{mr_id}/assessors/$!{aid}/files/displacements/$!{aid}_displacements.png"))
#set($prequal_pdf = $content.getURI("/data/experiments/$!{mr_id}/assessors/$!{aid}/files/prequal_pdf/$!{aid}_prequal_qc.pdf"))
#set($eddy_pdf = $content.getURI("/data/experiments/$!{mr_id}/assessors/$!{aid}/files/eddy_pdf/$!{aid}_eddy_quad_qc.pdf"))
#set($qsiprep_html = $content.getURI("/data/experiments/$!{mr_id}/assessors/$!{aid}/files/qsiprep-html/$!{aid}_qsiprep.html"))
#set($qsiprep_pdf = $content.getURI("/data/experiments/$!{mr_id}/assessors/$!{aid}/files/qsiprep-pdf/$!{aid}_qsiprep.pdf"))
#set($carpet_plot = $content.getURI("/data/experiments/$!{mr_id}/assessors/$!{aid}/files/carpet-plot/$!{aid}_carpetplot.svg"))
#set($t1_registration = $content.getURI("/data/experiments/$!{mr_id}/assessors/$!{aid}/files/t1-registration/$!{aid}_t1_registration.svg"))
#set($motion_plot = $content.getURI("/data/experiments/$!{mr_id}/assessors/$!{aid}/files/motion-plot/$!{aid}_motion_plot.png"))
#set($brain_mask = $content.getURI("/data/experiments/$!{mr_id}/assessors/$!{aid}/files/seg-brainmask/$!{aid}_seg_brainmask.svg"))
#set($denoise = $content.getURI("/data/experiments/$!{mr_id}/assessors/$!{aid}/files/denoise/$!{aid}_denoise.svg"))
#set($b0_volume = $content.getURI("/data/experiments/$!{mr_id}/assessors/$!{aid}/files/b0-volume/$!{aid}_b0_volume.nii.gz"))


#set($manual_wrap = $!item.getProperty("manual/wrap"))
#set($manual_motion = $!item.getProperty("manual/motion"))
#set($manual_cover = $!item.getProperty("manual/cover"))
#set($manual_inhom = $!item.getProperty("manual/inhom"))
#set($manual_ghost_brain = $!item.getProperty("manual/ghost_brain"))
#set($manual_ghost_out = $!item.getProperty("manual/ghost_out"))
#set($manual_spike = $!item.getProperty("manual/spike"))
#set($manual_overall = $!item.getProperty("manual/overall"))
#set($manual_comments = $!item.getProperty("manual/comments"))

<script type="text/javascript">
  $( function() {
    /**
     * Turn HTML elements into jQuery UI elements
     */
    $( "#tabs" ).tabs();
    $( "#menu" ).menu();

    /**
     * Populate Manual QC tab with previously saved data
     */
    switch("$!{manual_wrap}") {
      case "None": 
        $( "#wrap-none" ).attr("checked", "checked");
        break;
      case "Mild":
        $( "#wrap-mild" ).attr("checked", "checked");
        break;
      case "Moderate":
        $( "#wrap-moderate" ).attr("checked", "checked");
        break;
      case "Severe":
        $( "#wrap-severe" ).attr("checked", "checked");
        break;
      default:
        break;
    }

    switch("$!{manual_cover}") {
      case "Good": 
        $( "#cover-good" ).attr("checked", "checked");
        break;
      case "Mild":
        $( "#cover-mild" ).attr("checked", "checked");
        break;
      case "Moderate":
        $( "#cover-moderate" ).attr("checked", "checked");
        break;
      case "Severe":
        $( "#cover-severe" ).attr("checked", "checked");
        break;
      default:
        break;
    }

    switch("$!{manual_motion}") {
      case "None": 
        $( "#motion-none" ).attr("checked", "checked");
        break;
      case "Mild":
        $( "#motion-mild" ).attr("checked", "checked");
        break;
      case "Moderate":
        $( "#motion-moderate" ).attr("checked", "checked");
        break;
      case "Severe":
        $( "#motion-severe" ).attr("checked", "checked");
        break;
      default:
        break;
    }

    switch("$!{manual_inhom}") {
      case "None": 
        $( "#inhom-none" ).attr("checked", "checked");
        break;
      case "Moderate":
        $( "#inhom-moderate" ).attr("checked", "checked");
        break;
      case "Severe":
        $( "#inhom-severe" ).attr("checked", "checked");
        break;
      default:
        break;
    }

    switch("$!{manual_ghost_brain}") {
      case "None": 
        $( "#ghost_brain-none" ).attr("checked", "checked");
        break;
      case "Mild":
        $( "#ghost_brain-mild" ).attr("checked", "checked");
        break;
      case "Moderate":
        $( "#ghost_brain-moderate" ).attr("checked", "checked");
        break;
      case "Severe":
        $( "#ghost_brain-severe" ).attr("checked", "checked");
        break;
      default:
        break;
    }

    switch("$!{manual_ghost_out}") {
      case "None": 
        $( "#ghost_out-none" ).attr("checked", "checked");
        break;
      case "Mild":
        $( "#ghost_out-mild" ).attr("checked", "checked");
        break;
      case "Moderate":
        $( "#ghost_out-moderate" ).attr("checked", "checked");
        break;
      case "Severe":
        $( "#ghost_out-severe" ).attr("checked", "checked");
        break;
      default:
        break;
    }

    switch("$!{manual_spike}") {
      case "None": 
        $( "#spike-none" ).attr("checked", "checked");
        break;
      case "Mild":
        $( "#spike-mild" ).attr("checked", "checked");
        break;
      case "Moderate":
        $( "#spike-moderate" ).attr("checked", "checked");
        break;
      case "Severe":
        $( "#spike-severe" ).attr("checked", "checked");
        break;
      default:
        break;
    }

    switch("$!{manual_overall}") {
      case "PASS": 
        $( "#overall-pass" ).attr("checked", "checked");
        break;
      case "WARN":
        $( "#overall-warn" ).attr("checked", "checked");
        break;
      case "FAIL":
        $( "#overall-fail" ).attr("checked", "checked");
        break;
      default:
        break;
    }

    /**
     * Save button click event
     */
    $( "#manualqc_save").click( function(event) {
      var wrap = $( "input[name='wrap']:checked" ).val();
      var cover = $( "input[name='cover']:checked" ).val();
      var motion = $( "input[name='motion']:checked" ).val();
      var ghost_brain = $( "input[name='ghost_brain']:checked" ).val();
      var ghost_out = $( "input[name='ghost_out']:checked" ).val();
      var spike = $( "input[name='spike']:checked" ).val();
      var inhom = $( "input[name='inhom']:checked" ).val();
      var overall = $( "input[name='overall']:checked" ).val();
      var comments = $( "#comments" ).val();
      var url = "/data/experiments/$!{mr_id}/assessors/$!{aid}"
      var data = {
        "neuroinfo:dwiqc/manual/wrap": wrap,
        "neuroinfo:dwiqc/manual/cover": cover,
        "neuroinfo:dwiqc/manual/motion": motion,
        "neuroinfo:dwiqc/manual/ghost_brain": ghost_brain,
        "neuroinfo:dwiqc/manual/ghost_out": ghost_out,
        "neuroinfo:dwiqc/manual/spike": spike,
        "neuroinfo:dwiqc/manual/inhom": inhom,
        "neuroinfo:dwiqc/manual/overall": overall,
        "neuroinfo:dwiqc/manual/comments": comments,
        "XNAT_CSRF": csrfToken
      }
      $.ajax({
        url: url + "?" + $.param(data),
        type: "put",
        beforeSend: function(xhr) {
          $( "#manualqc_save" ).val("Saving").button({
            disabled: true
          });
        },
        success: function(response) {
          $( "#manualqc_save" ).val("Saved");
        },
        error: function(xhr) {
          $( "#manualqc_save" ).val("Error");
        }
      });
    });
  });
</script>

<style>
  .image-box {
    border: 1px solid #ececec;
    padding: 4px;
  }

  .pane {
    background-color: #fff;
    border: 1px solid grey;
    padding: 4px;
    font-size: 11px;
    vertical-align: top;
  }

  .big-table {
    width: 100%;
    border-collapse: collapse;
  }

  .big-table td {
    border-bottom: 1px solid #cccccc;
    padding: 4px;
    text-align: left;
  }

  .big-table th {
    background-color: #f6f6f6;
    position: sticky;
    top: 0;
    padding: 5px;
    box-shadow: 0 2px 2px -1px rgba(0, 0, 0, 0.4);
  }

  .bigtable-key {
    width: 1%;
  }

  .big-table tr:nth-child(odd) {
    
  }

  .big-table tr:hover {
    background-color: #cccccc;
  }

  .sidebox {
    border-collapse: collapse;
    width: 100%;
    border: 1px solid #bfbfbf;
  }

  .sidebox th {
    align: left;
    background-color: #cccccc;
    padding: 1px;
  }

  .sidebox tr:nth-child(odd) {
    background-color: #f6f6f6;
  }

  .sidebox td { 
    padding-left: 3px;
    padding-right: 3px;
    width: 50%
  }

  .sidebox tr:hover {
    background-color: #cccccc;
  }

  .prequal-bar {
    border-right: 2px solid #cc00cc;
    padding-right: 4px;
  }
  
  .eddy_quad-bar {
    border-right: 2px solid #00e6bf;
    padding-right: 4px;
  }

  .tile-img {
    width: 380px;
  }
  .tile-img-mask { 
    width: 380px;
    vertical-align: top;
  }
  .ui-menu { width: 65px; }
  .ui-tabs-panel {
    height: 683px;
    overflow-y: auto;
  }
</style>

<!-- border container -->
<table style="width: 100%; height: 683px">
  <!-- menu bar -->
  <tr id="menu-bar">
    <td class="pane" colspan="2">
      <div style="margin: 2px">
        <ul id="menu">
          <li><div>Action</div>
            <ul>
              <li><div><a href=$content.getURI("/data/experiments/$!{mr_id}/assessors/$!{aid}?format=xml")>View XML</a></div></li>
              <li><div><a href="$!{delete_url}">Delete</a></div></li>
            </ul>
          </li>
        </ul>
      </div>
    </td>
  </tr>
  <!-- side pane -->
  <tr id="side-pane">
    <td class="pane" style="width: 220px">
      <div style="margin: 2px">
        <!-- summary table -->
        <table class="sidebox">
          <th colspan="2">Summary</th>
          <tr><td>MR Session</td><td align="right"><a href="/data/experiments/$!mr_id?format=html">$!mr_label</a></td></tr>
          <tr><td>Date Processed</td><td align="right">$!item.getStringProperty("${dtype}/date")</td></tr>
          <tr><td>PA Fmap Scan</td><td align="right">$!item.getStringProperty("${dtype}/PA_fmap_scan_id")</td></tr>
          <tr><td>AP Fmap Scan</td><td align="right">$!item.getStringProperty("${dtype}/AP_fmap_scan_id")</td></tr>
          <tr><td>DWI Scan</td><td align="right">$!item.getStringProperty("${dtype}/dwi_scan_id")</td></tr>
        </table>
        <br />
        <table class="sidebox">
          <th colspan="2">SNR/CNR Metrics</th>
          <tr style="background: #f5f5f5; border-bottom: 1px solid #bfbfbf">
            <td style="padding: 3px" colspan="3">Eddy Quad <span style="font-weight: bold; color: #00e6bf">&mdash;</span></td>
           <!-- <td style="padding: 3px">Prequal <span style="font-weight: bold; color: #cc00cc">&mdash;</span></td>-->
          </tr>
          <tr><td>B0 SNR:</td><td class="eddy_quad-bar" align="right">#numberFormat($floatFormat3 $!item.getProperty("eddy_quad/Average_SNR_b0"))</td></tr>
          <tr><td>B500 CNR:</td><td class="eddy_quad-bar" align="right">#numberFormat($floatFormat3 $!item.getProperty("eddy_quad/Average_CNR_b500"))</td></tr>
          <tr><td>B1000 CNR:</td><td class="eddy_quad-bar" align="right">#numberFormat($floatFormat3 $!item.getProperty("eddy_quad/Average_CNR_b1000"))</td></tr>
          <tr><td>B2000 CNR:</td><td class="eddy_quad-bar" align="right">#numberFormat($floatFormat3 $!item.getProperty("eddy_quad/Average_CNR_b2000"))</td></tr>
          <tr><td>B3000 CNR:</td><td class="eddy_quad-bar" align="right">#numberFormat($floatFormat3 $!item.getProperty("eddy_quad/Average_CNR_b3000"))</td></tr>
        </table>
        <!-- motion metrics -->
        <table class="sidebox">
          <th colspan="3">Motion Metrics</th>
          <tr style="background: #f5f5f5; border-bottom: 1px solid #bfbfbf">
          </tr>
          <tr>
            <td colspan="2">Avg Abs Motion:</td>
            <td colspan="2" align="right">#numberFormat($floatFormat3 $!item.getProperty("eddy_quad/Average_abs_motion_mm"))</td>
          </tr>
          <tr>
            <td colspan="2">Avg Rel Motion:</td>
            <td colspan="2" align="right">#numberFormat($floatFormat3 $!item.getProperty("eddy_quad/Average_rel_motion_mm"))</td>
          </tr>
          <tr>
            <td colspan="2">Avg X Translation:</td>
            <td colspan="2" align="right">#numberFormat($floatFormat3 $!item.getProperty("eddy_quad/Average_x_translation_mm"))</td>
          </tr>
          <tr>
            <td colspan="2">Avg Y Translation:</td>
            <td colspan="2" align="right">#numberFormat($floatFormat3 $!item.getProperty("eddy_quad/Average_y_translation_mm"))</td>
          </tr>
          <tr>
            <td colspan="2">Avg Z Translation:</td>
            <td colspan="2" align="right">#numberFormat($floatFormat3 $!item.getProperty("eddy_quad/Average_z_translation_mm"))</td>
          </tr>
        </table>
        <br />
        <table class="sidebox">
          <th colspan="2">Files</th>
          <tr><td><a href="#" data-featherlight="$!{b0_avg}">B0 Average</a></td><td><a href="#" data-featherlight="$!{motion_plot}">Motion Plot</a></td></tr>
          <tr><td><a href="#" data-featherlight="$!{b500_avg}">B500 Average</a></td><td><a href="#" data-featherlight="<object type='image/svg+xml' data='$!{brain_mask}' style='width:65vw'></object>">Brain Mask</a></td></tr>
          <tr><td><a href="#" data-featherlight="$!{b1000_avg}">B1000 Average</a></td><td><a href="#" data-featherlight="<object type='image/svg+xml' data='$!{denoise}' style='width:65vw'></object>">Denoise</a></td></tr>
          <tr><td><a href="#" data-featherlight="$!{b2000_avg}">B2000 Average</a></td><td><a href="#" data-featherlight="$!{carpet_plot}">Carpet Plot</a></td></tr>
          <tr><td><a href="#" data-featherlight="$!{b3000_avg}">B3000 Average</a></td><td width="200"><a href="#" data-featherlight="<object type='image/svg+xml' data='$!{t1_registration}' style='width:65vw'></object>">T1 Registration</a></td></tr>
          <tr><td><a href="#" data-featherlight="$!{FA_map}">FA Map</a></td><td><a href="$!{prequal_pdf}" target="_blank">Prequal Report</a></td></tr>
          <tr><td><a href="#" data-featherlight="$!{MD_map}">MD Map</a></td><td><a href="$!{eddy_pdf}" target="_blank">Eddy Quad Report</a></td></tr>
          <tr><td><a href="#" data-featherlight="$!{eddy_outlier_slices}">Eddy Outlier Slices</a></td><td><a href="$!{qsiprep_pdf}" target="_blank">Qsiprep Report</a></td></tr>
        </table>
      </div>
    </td>
    <!-- tabs pane -->
    <td id="tabs-pane" class="pane" style="vertical-align: top">
      <div id="tabs">
        <ul>
          <li><a href="#images-tab">Images</a></li>
          <li><a href="#prequal-report-tab">Prequal Report</a></li>
          <li><a href="#eddy-quad-report-tab">Eddy Quad Report</a></li>
          <li><a href="#qsiprep-report-tab">Qsiprep Report</a></li>
          <li><a href="#manualqc-tab">Manual QC</a></li>
          <li><a href="#files-tab">All Stored Files</a></li>
        </ul>
        <!-- begin images-tab -->
        <div id="images-tab" style="padding:0px; margin:2px">
          <table id="anatqc-images-table" cellspacing="10">
            <tr>
              <td>
                <table class="image-box">
                  <tr>
                    <td align="left">FA Map</td>
                  </tr>
                  <tr>
                    <td colspan="2"><a href="#" data-featherlight="$!{FA_map}"><img class="tile-img" src="$!{FA_map}"></img></a></td>
                  </tr>
                </table>
              </td>
              <td>
                <table class="image-box">
                  <tr>
                    <td align="left">MD Map</td>
                  </tr>
                  <tr>
                    <td colspan="2"><a href="#" data-featherlight="$!{MD_map}"><img class="tile-img" src="$!{MD_map}"></img></a></td>
                  </tr>
                </table>
              </td>
            </tr>
            <tr>
              <td valign="top">
                <table class="image-box">
                  <tr>
                    <td align="left">Motion Plot</td>
                  </tr>
                  <tr>
                    <td colspan="2"><a href="#" data-featherlight="$!{motion_plot}"><img class="tile-img" src="$!{motion_plot}"></img></a></td>
                  </tr>
                </table>
              </td>
              <td valign="top">
                <table class="image-box">
                  <tr>
                    <td align="left">Brain Mask</td>
                  </tr>
                  <tr>
                    <td colspan="2"><a href="#" data-featherlight="<object type='image/svg+xml' data='$!{brain_mask}' style='width:65vw'></object>"><img class="tile-img-mask" src="$!{brain_mask}"></img></a></td>
                  </tr>
                  <tr style="height: 25px;"></tr>
                  <tr>
                    <td align="left">Outlier Slices</td>
                  </tr>
                  <tr>
                    <td colspan="2"><a href="#" data-featherlight="$!{eddy_outlier_slices}"><img class="tile-img-mask" src="$!{eddy_outlier_slices}"></img></a></td>
                  </tr>
                  <tr style="height: 25px;"></tr>
                  <tr>
                    <td align="left">Framewise Displacement</td>
                  </tr>
                  <tr>
                    <td colspan="1"><a href="#" data-featherlight="$!{carpet_plot}"><img class="tile-img" src="$!{carpet_plot}"></img></a></td>
                  </tr>
                </table>
              </td>
             </tr>
          </table>
        </div>
        <!-- end images-tab -->
        <!-- begin prequal-report-tab -->
        <div id="prequal-report-tab" style="padding: 0px; margin:2px;">
          <div style="width: 100%">
            <iframe src="$!{prequal_pdf}" style="width: 100%; height: 900px" frameBorder="0"></iframe>
          </div>
        </div>
        <!-- end prequal-report-tab -->
        <!-- begin eddy-quad-report-tab -->
        <div id="eddy-quad-report-tab" style="padding: 0px; margin:2px overflow:auto;">
          <div style="width: 100%">
            <iframe src="$!{eddy_pdf}" style="width: 100%; height: 900px" frameBorder="0"></iframe>
          </div>
        </div>
        <!-- end eddy-quad-report-tab -->
        <!-- begin qsiprep-report-tab -->
        <div id="qsiprep-report-tab" style="padding: 0px; margin:2px overflow:auto;">
          <div style="width: 100%">
            <iframe src="$!{qsiprep_pdf}" style="width: 100%; height: 900px" frameBorder="0"></iframe>
          </div>
        </div>
        <!-- end qsiprep-report-tab -->
        <!-- begin manualqc-tab -->
        <div id="manualqc-tab" style="padding:0px; margin:0px">
          <table>
            <tr>
              <td>
                <h2>Wrapping</h2>
                <hr style="border: 5px solid #e4efff"/>
                <table>
                  <tr>
                    <td><input type="radio" name="wrap" id="wrap-none" value="None"></td>
                    <td>None - no wrapping</td>
                  </tr>
                  <tr>
                    <td><input type="radio" name="wrap" id="wrap-mild" value="Mild"></td>
                    <td>Mild - through skull but not brain</td>
                  </tr>
                  <tr>
                    <td><input type="radio" name="wrap" id="wrap-moderate" value="Moderate"></td>
                    <td>Moderate - into brain a few slices</td>
                  </tr>
                  <tr>
                    <td><input type="radio" name="wrap" id="wrap-severe" value="Severe"></td>
                    <td>Severe - prominently extends into brain</td>
                  </tr>
                </table>
              </td>
            </tr>
            <tr>
              <td>
                <h2>Head Coverage</h2>
                <hr style="border: 5px solid #e4efff"/>
                <table>
                  <tr>
                    <td><input type="radio" name="cover" id="cover-good" value="Good"></td>
                    <td>Good - full head coverage</td>
                  </tr>
                  <tr>
                    <td><input type="radio" name="cover" id="cover-mild" value="Mild"></td>
                    <td>Mild - clips part of skull, but not brain</td>
                  </tr>
                  <tr>
                    <td><input type="radio" name="cover" id="cover-moderate" value="Moderate"></td>
                    <td>Moderate - clips a few slices brain</td>
                  </tr>
                  <tr>
                    <td><input type="radio" name="cover" id="cover-severe" value="Severe"></td>
                    <td>Severe - affects brain coverage</td>
                  </tr>
                </table>
              </td>
            </tr>
            <tr>
              <td>
                <h2>Motion Ringing/Striping/Blurring - Affects Brain</h2>
                <hr style="border: 5px solid #e4efff"/>
                <table>
                  <tr>
                    <td><input type="radio" name="motion" id="motion-none" value="None"></td>
                    <td>None</td>
                  </tr>
                  <tr>
                    <td><input type="radio" name="motion" id="motion-mild" value="Mild"></td>
                    <td>Mild</td>
                  </tr>
                  <tr>
                    <td><input type="radio" name="motion" id="motion-moderate" value="Moderate"></td>
                    <td>Moderate</td>
                  </tr>
                  <tr>
                    <td><input type="radio" name="motion" id="motion-severe" value="Severe"></td>
                    <td>Severe</td>
                  </tr>
                </table>
              </td>
            </tr>
            <tr>
              <td>
                <h2>Ghosting/Blurring - Affects Brain</h2>
                <hr style="border: 5px solid #e4efff"/>
                <table>
                  <tr>
                    <td><input type="radio" name="ghost_brain" id="ghost_brain-none" value="None"></td>
                    <td>None</td>
                  </tr>
                  <tr>
                    <td><input type="radio" name="ghost_brain" id="ghost_brain-mild" value="Mild"></td>
                    <td>Mild</td>
                  </tr>
                  <tr>
                    <td><input type="radio" name="ghost_brain" id="ghost_brain-moderate" value="Moderate"></td>
                    <td>Moderate</td>
                  </tr>
                  <tr>
                    <td><input type="radio" name="ghost_brain" id="ghost_brain-severe" value="Severe"></td>
                    <td>Severe</td>
                  </tr>
                </table>
              </td>
            </tr>
            <tr>
              <td>
                <h2>Ghosting/Blurring - Outside of Brain</h2>
                <hr style="border: 5px solid #e4efff"/>
                <table>
                  <tr>
                    <td><input type="radio" name="ghost_out" id="ghost_out-none" value="None"></td>
                    <td>None</td>
                  </tr>
                  <tr>
                    <td><input type="radio" name="ghost_out" id="ghost_out-mild" value="Mild"></td>
                    <td>Mild</td>
                  </tr>
                  <tr>
                    <td><input type="radio" name="ghost_out" id="ghost_out-moderate" value="Moderate"></td>
                    <td>Moderate</td>
                  </tr>
                  <tr>
                    <td><input type="radio" name="ghost_out" id="ghost_out-severe" value="Severe"></td>
                    <td>Severe</td>
                  </tr>
                </table>
              </td>
            </tr>
            <tr>
              <td>
                <h2>RF Noise/Spiking</h2>
                <hr style="border: 5px solid #e4efff"/>
                <table>
                  <tr>
                    <td><input type="radio" name="spike" id="spike-none" value="None"></td>
                    <td>None - no abnormal RF noise</td>
                  </tr>
                  <tr>
                    <td><input type="radio" name="spike" id="spike-mild" value="Mild"></td>
                    <td>Mild - little static with no distinct pattern</td>
                  </tr>
                  <tr>
                    <td><input type="radio" name="spike" id="spike-moderate" value="Moderate"></td>
                    <td>Moderate - low-level static with pattern (bands, spheres)</td>
                  </tr>
                  <tr>
                    <td><input type="radio" name="spike" id="spike-severe" value="Severe"></td>
                    <td>Severe - RF spiking visible</td>
                  </tr>
                </table>
              </td>
            </tr>
            <tr>
              <td>
                <h2>b0 Volume Unexpected Inhomogeneity</h2>
                <hr style="border: 5px solid #e4efff"/>
                <table>
                  <tr>
                    <td><input type="radio" name="inhom" id="inhom-none" value="None"></td>
                    <td>None</td>
                  </tr>
                  <tr>
                    <td><input type="radio" name="inhom" id="inhom-moderate" value="Moderate"></td>
                    <td>Unexpected - moderate</td>
                  </tr>
                  <tr>
                    <td><input type="radio" name="inhom" id="inhom-severe" value="Severe"></td>
                    <td>Unexpected - severe</td>
                  </tr>
                </table>
              </td>
            </tr>
            <tr>
              <td>
                <h2>Additional Comments</h2>
                <textarea id="comments" style="width: 100%; height: 102px">$!{manual_comments}</textarea>
              </td>
            </tr>
            <tr>
              <td>
                <h2>Overall QC Assessment</h2>
                <hr style="border: 5px solid #e4efff"/>
                <table>
                  <tr>
                    <td><input type="radio" name="overall" id="overall-pass" value="PASS"></td>
                    <td>PASS - Data passed quality control</td>
                  </tr>
                  <tr>
                    <td><input type="radio" name="overall" id="overall-warn" value="WARN"></td>
                    <td>WARN - Data have significant quality issues</td>
                  </tr>
                  <tr>
                    <td><input type="radio" name="overall" id="overall-fail" value="FAIL"></td>
                    <td>FAIL - Data failed quality control</td>
                  </tr>
                </table>
              </td>
            </tr>
            <tr>
              <td><br/><input class="ui-button ui-widget ui-corner-all" id="manualqc_save" type="button" value="Save" /></td>
            </tr>
          </table>
        </div>
        <!-- end manual qc tab -->
        <!-- begin files tab -->
        <div id="files-tab" style="padding:0px; margin:2px">
          <table class="big-table">
            <tr>
              <th align="left">#</th>
              <th align="left">File</th>
              <th align="left">Description</th>
              <th align="left">Type</th>
            </tr>
            <tr>
              <td>1</td>
              #set($name = "${aid}_preprocessed_b0.png")
              <td><a download="$!{name}" href="$!{b0_avg}">$!{name}</a></td>
              <td>b0 Preprocessed</td>
              <td>image/png</td>
            </tr>
            <tr>
              <td>2</td>
              #set($name = "${aid}_preprocessed_b500.png")
              <td><a download="$!{name}" href="$!{b500_avg}">$!{name}</a></td>
              <td>b500 Preprocessed</td>
              <td>image/png</td>
            </tr>
            <tr>
              <td>3</td>
              #set($name = "${aid}_preprocessed_b1000.png")
              <td><a download="$!{name}" href="$!{b1000_avg}">$!{name}</a></td>
              <td>b1000 Preprocessed</td>
              <td>image/png</td>
            </tr>
            <tr>
              <td>4</td>
              #set($name = "${aid}_preprocessed_b2000.png")
              <td><a download="$!{name}" href="$!{b2000_avg}">$!{name}</a></td>
              <td>b2000 Preprocessed</td>
              <td>image/png</td>
            </tr>
            <tr>
              <td>5</td>
              #set($name = "${aid}_preprocessed_b3000.png")
              <td><a download="$!{name}" href="$!{b3000_avg}">$!{name}</a></td>
              <td>b3000 Preprocessed</td>
              <td>image/png</td>
            </tr>
            <tr>
              <td>6</td>
              #set($name = "${aid}_FA.png")
              <td><a download="$!{name}" href="$!{FA_map}">$!{name}</a></td>
              <td>FA Map</td>
              <td>image/png</td>
            </tr>
            <tr>
              <td>7</td>
              #set($name = "${aid}_MD.png")
              <td><a download="$!{name}" href="$!{MD_map}">$!{name}</a></td>
              <td>MD Map</td>
              <td>image/png</td>
            </tr>
            <tr>
              <td>8</td>
              #set($name = "${aid}_eddy_outlier_slices.png")
              <td><a download="$!{name}" href="$!{eddy_outlier_slices}">$!{name}</a></td>
              <td>Eddy Outlier Slices</td>
              <td>image/png</td>
            </tr>
            <tr>
              <td>9</td>
              #set($name = "${aid}_translations.png")
              <td><a download="$!{name}" href="$!{translations}">$!{name}</a></td>
              <td>Motion Translations</td>
              <td>image/png</td>
            </tr>
            <tr>
              <td>10</td>
              #set($name = "${aid}_rotations.png")
              <td><a download="$!{name}" href="$!{rotations}">$!{name}</a></td>
              <td>Motion Rotations</td>
              <td>image/png</td>
            </tr>
            <tr>
              <td>11</td>
              #set($name = "${aid}_displacements.png")
              <td><a download="$!{name}" href="$!{displacements}">$!{name}</a></td>
              <td>Motion Displacements</td>
              <td>image/png</td>
            </tr>
            <tr>
              <td>12</td>
              #set($name = "${aid}_prequal_qc.pdf")
              <td><a download="$!{name}" href="$!{prequal_pdf}">$!{name}</a></td>
              <td>Prequal Report</td>
              <td>report/pdf</td>
            </tr>
            <tr>
              <td>13</td>
              #set($name = "${aid}_eddy_quad_qc.pdf")
              <td><a download="$!{name}" href="$!{eddy_pdf}">$!{name}</a></td>
              <td>Eddy Quad Report</td>
              <td>report/pdf</td>
            </tr>
            <tr>
              <td>14</td>
              #set($name = "${aid}_qsiprep.html")
              <td><a download="$!{name}" href="$!{qsiprep_html}">$!{name}</a></td>
              <td>Qsiprep html Report</td>
              <td>report/html</td>
            </tr>
            <tr>
              <td>15</td>
              #set($name = "${aid}_qsiprep.pdf")
              <td><a download="$!{name}" href="$!{qsiprep_pdf}">$!{name}</a></td>
              <td>Qsiprep pdf Report</td>
              <td>report/pdf</td>
            </tr>
            <tr>
              <td>16</td>
              #set($name = "${aid}_carpetplot.svg")
              <td><a download="$!{name}" href="$!{carpet_plot}">$!{name}</a></td>
              <td>Framewise Displacement Plot</td>
              <td>image/svg</td>
            </tr>
            <tr>
              <td>17</td>
              #set($name = "${aid}_t1_registration.svg")
              <td><a download="$!{name}" href="$!{t1_registration}">$!{name}</a></td>
              <td>T1 Registration</td>
              <td>image/svg</td>
            </tr>
            <tr>
              <td>18</td>
              #set($name = "${aid}_motion_plot.png")
              <td><a download="$!{name}" href="$!{motion_plot}">$!{name}</a></td>
              <td>Motion Plot</td>
              <td>image/png</td>
            </tr>
            <tr>
              <td>19</td>
              #set($name = "${aid}_seg_brainmask.svg")
              <td><a download="$!{name}" href="$!{brain_mask}">$!{name}</a></td>
              <td>Brain Mask</td>
              <td>image/svg</td>
            </tr>
            <tr>
              <td>20</td>
              #set($name = "${aid}_b0-volume.nii.gz")
              <td><a download="$!{name}" href="$!{b0_volume}">$!{name}</a></td>
              <td>b0 Volume</td>
              <td>file/nii.gz</td>
            </tr>
          </table>
        </div>
        <!-- end files-tab -->
      </div>
    </td>
  </tr>
</table>
